{{ block "content" .}}

<div class="page-header">
    <h1>Skills Gap Analyzer</h1>
    <p class="subtitle">Compare your skills with job requirements</p>
</div>

<div class="analyzer-layout">
    <!-- Input Form -->
    <div class="analyzer-section">
        <div class="section-card">
            <h2>Analyze Job Description</h2>
            
            <form onsubmit="analyzeSkills(event)">
                <div class="form-group">
                    <label class="form-label">Job Description *</label>
                    <textarea class="form-textarea large" name="job_description" 
                              placeholder="Paste the job description here..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Your Skills</label>
                    <textarea class="form-textarea" name="user_skills" 
                              placeholder="AWS, Python, Fortinet, SIEM, Docker...">{{.UserSkills}}</textarea>
                    <small class="form-help">Separate skills with commas</small>
                </div>
                
                <button type="submit" class="btn btn-primary full-width">
                    <span class="loading hidden" id="analyzeLoader"></span>
                    Analyze Skills Gap
                </button>
            </form>
        </div>
    </div>

    <!-- Results -->
    <div class="analyzer-section">
        <div class="section-card">
            <h2>Analysis Results</h2>
            <div id="analysisResults" class="analyzer-results">
                <div class="placeholder-state">
                    <p>Enter a job description and your skills to see the analysis</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Your Skills Profile -->
<div class="section">
    <div class="section-card">
        <div class="section-header">
            <h2>Your Skills Profile</h2>
            <button class="btn btn-outline btn-sm" onclick="showAddSkill()">Add Skill</button>
        </div>
        
        <div class="skills-profile">
            {{range .SkillsList}}
            <span class="skill-tag profile">{{.}}</span>
            {{else}}
            <div class="empty-state small">
                <p>No skills added yet. Add your skills to get better job matches.</p>
            </div>
            {{end}}
        </div>
    </div>
</div>

<!-- Add Skill Modal -->
<div id="addSkillModal" class="modal">
    <div class="modal-content small">
        <div class="modal-header">
            <h3>Add Skill</h3>
            <button class="modal-close" onclick="hideAddSkill()">√ó</button>
        </div>
        <form onsubmit="addSkill(event)">
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" class="form-input" placeholder="Enter skill (e.g., AWS, Python, Docker)..." 
                           id="newSkill" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="hideAddSkill()">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Skill</button>
            </div>
        </form>
    </div>
</div>

<script>
function analyzeSkills(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    const data = Object.fromEntries(formData);
    
    // Convert skills string to array
    if (data.user_skills) {
        data.user_skills = data.user_skills.split(',').map(skill => skill.trim()).filter(skill => skill);
    }
    
    const loader = document.getElementById('analyzeLoader');
    const button = loader.parentElement;
    
    loader.classList.remove('hidden');
    button.disabled = true;
    button.innerHTML = '<span class="loading"></span> Analyzing...';
    
    fetch('/analyze-skills', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(analysis => {
        displayAnalysis(analysis);
    })
    .catch(error => {
        document.getElementById('analysisResults').innerHTML = `
            <div class="error-state">
                <p>Analysis failed: ${error.message}</p>
            </div>
        `;
    })
    .finally(() => {
        loader.classList.add('hidden');
        button.disabled = false;
        button.innerHTML = 'Analyze Skills Gap';
    });
}

function displayAnalysis(analysis) {
    const results = document.getElementById('analysisResults');
    
    results.innerHTML = `
        <div class="analysis-view">
            <!-- Fit Score -->
            <div class="fit-score-display">
                <div class="score-circle large ${getScoreClass(analysis.fit_score)}">
                    ${analysis.fit_score}%
                </div>
                <div class="score-info">
                    <h3>Overall Skills Fit</h3>
                    <p>${getFitDescription(analysis.fit_score)}</p>
                </div>
            </div>
            
            <!-- Skills Match -->
            <div class="skills-comparison-grid">
                <div class="skills-column matching">
                    <h4>‚úÖ Matching Skills</h4>
                    <div class="skills-container">
                        ${analysis.matching_skills.map(skill => 
                            `<span class="skill-badge match">${skill}</span>`
                        ).join('')}
                        ${analysis.matching_skills.length === 0 ? 
                            '<div class="no-items">No matching skills found</div>' : ''}
                    </div>
                </div>
                
                <div class="skills-column missing">
                    <h4>‚ùå Missing Skills</h4>
                    <div class="skills-container">
                        ${analysis.missing_skills.map(skill => 
                            `<span class="skill-badge missing">${skill}</span>`
                        ).join('')}
                        ${analysis.missing_skills.length === 0 ? 
                            '<div class="no-items">No missing skills - excellent fit!</div>' : ''}
                    </div>
                </div>
            </div>
            
            <!-- Transferable Skills -->
            ${analysis.transferable && analysis.transferable.length > 0 ? `
            <div class="transferable-skills">
                <h4>üîÑ Transferable Skills</h4>
                <div class="skills-container">
                    ${analysis.transferable.map(skill => 
                        `<span class="skill-badge transferable">${skill}</span>`
                    ).join('')}
                </div>
            </div>
            ` : ''}
            
            <!-- Recommendations -->
            ${analysis.recommendations && analysis.recommendations.length > 0 ? `
            <div class="recommendations-section">
                <h4>üí° Recommendations</h4>
                <div class="recommendations-list">
                    ${analysis.recommendations.map(rec => 
                        `<div class="recommendation-item">${rec}</div>`
                    ).join('')}
                </div>
            </div>
            ` : ''}
        </div>
    `;
}

function getScoreClass(score) {
    if (score >= 80) return 'excellent';
    if (score >= 60) return 'good';
    if (score >= 40) return 'fair';
    return 'poor';
}

function getFitDescription(score) {
    if (score >= 80) return 'Excellent match! You have most required skills.';
    if (score >= 60) return 'Good match. You have many required skills.';
    if (score >= 40) return 'Fair match. Consider developing some key skills.';
    return 'Limited match. Significant skill development needed.';
}

function showAddSkill() {
    document.getElementById('addSkillModal').classList.add('active');
    document.getElementById('newSkill').focus();
}

function hideAddSkill() {
    document.getElementById('addSkillModal').classList.remove('active');
}

function addSkill(event) {
    event.preventDefault();
    const skill = document.getElementById('newSkill').value.trim();
    
    if (skill) {
        fetch('/skills/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ skill: skill })
        })
        .then(response => response.json())
        .then(result => {
            if (result.status === 'success') {
                showNotification('Skill added successfully!', 'success');
                hideAddSkill();
                location.reload();
            } else {
                showNotification(result.error || 'Failed to add skill', 'error');
            }
        })
        .catch(error => {
            showNotification('Error: ' + error.message, 'error');
        });
    }
}

// Close modals when clicking outside
document.addEventListener('click', function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.classList.remove('active');
    }
});
</script>
{{end}}