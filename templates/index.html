{{block "content" .}}

<div class="page-header">
    <h1>JobHunter </h1>
    <p class="subtitle">Intelligent job search and application automation</p>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value">{{.TotalJobs}}</div>
        <div class="stat-label">Total Jobs</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{.HighScoreJobs}}</div>
        <div class="stat-label">High Match</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{.TotalApplications}}</div>
        <div class="stat-label">Applications</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{.ResponseRate}}%</div>
        <div class="stat-label">Response Rate</div>
    </div>
</div>

<!-- Quick Actions -->
<div class="actions-grid">
    <div class="action-card">
        <h3>Find Jobs</h3>
        <p>Scrape latest job listings</p>
        <button class="btn btn-primary full-width" onclick="startScraping()">
            <span class="loading hidden" id="scrapingLoader"></span>
            Scrape Jobs
        </button>
    </div>
    
    <div class="action-card">
        <h3>Analyze Skills</h3>
        <p>Check job fit</p>
        <a href="/analyzer" class="btn btn-outline full-width">Analyze</a>
    </div>
    
    <div class="action-card">
        <h3>Track Applications</h3>
        <p>Manage your applications</p>
        <a href="/tracker" class="btn btn-outline full-width">View Tracker</a>
    </div>
</div>

<!-- Recent High-Score Jobs -->
<div class="section">
    <div class="section-header">
        <h2>High Probability Opportunities</h2>
    </div>
    
    <div class="jobs-list">
        {{range .RecentJobs}}
        <div class="job-card {{if gt .Score 80}}high-score{{else if gt .Score 60}}medium-score{{else}}low-score{{end}}">
            <div class="job-content">
                <div class="job-main">
                    <h3 class="job-title">{{.Title}}</h3>
                    <p class="job-company">{{.Company}} â€¢ {{.Location}}</p>
                    <div class="job-meta">
                        <span class="job-source">{{.Source}}</span>
                        <span class="job-date">{{.PostedDate}}</span>
                        {{if .SalaryRange}}<span class="job-salary">{{.SalaryRange}}</span>{{end}}
                    </div>
                    <div class="job-skills">
                        {{range .Skills}}
                        <span class="skill-tag">{{.}}</span>
                        {{end}}
                    </div>
                </div>
                
                <div class="job-actions">
                    <div class="score-badge {{if gt .Score 80}}score-high{{else if gt .Score 60}}score-medium{{else}}score-low{{end}}">
                        {{.Score}}% Match
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary btn-sm" 
                                onclick="applyForJob('{{.ID}}', '{{.Title}}', '{{.Company}}')">
                            Apply
                        </button>
                        {{if .URL}}
                        <a href="{{.URL}}" target="_blank" class="btn btn-outline btn-sm">
                            View
                        </a>
                        {{end}}
                    </div>
                </div>
            </div>
        </div>
        {{else}}
        <div class="empty-state">
            <h3>No jobs found</h3>
            <p>Try refreshing the job listings to find opportunities</p>
            <button class="btn btn-primary" onclick="startScraping()">Scrape Jobs</button>
        </div>
        {{end}}
    </div>
</div>

<script>
function startScraping() {
    const loader = document.getElementById('scrapingLoader');
    const button = event.target;
    
    loader.classList.remove('hidden');
    button.disabled = true;
    button.innerHTML = '<span class="loading"></span> Scraping...';
    
    fetch('/jobs/scrape')
        .then(response => response.json())
        .then(data => {
            showNotification(data.message, 'success');
            setTimeout(() => location.reload(), 3000);
        })
        .catch(error => {
            showNotification('Scraping failed: ' + error.message, 'error');
        })
        .finally(() => {
            loader.classList.add('hidden');
            button.disabled = false;
            button.innerHTML = 'Scrape Jobs';
        });
}

function applyForJob(jobId, title, company) {
    if (confirm(`Apply for "${title}" at ${company}?`)) {
        fetch(`/jobs/${jobId}/apply`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                applied_date: new Date().toISOString().split('T')[0]
            })
        })
        .then(response => response.json())
        .then(data => {
            showNotification(data.message, 'success');
        })
        .catch(error => {
            showNotification('Application failed: ' + error.message, 'error');
        });
    }
}

function showNotification(message, type) {
    // Simple notification implementation
    alert(message);
}
</script>
{{end}}